<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Synthetic Health DB</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:#0d1117;color:#e6edf3;min-height:100vh}.hero{background:linear-gradient(135deg,#1e3a8a,#3b82f6);padding:30px 20px;text-align:center}.hero h1{font-size:28px;margin-bottom:6px}.hero p{opacity:.9;font-size:13px}.badge{background:#f59f00;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;margin-bottom:10px;display:inline-block}.container{max-width:1100px;margin:0 auto;padding:24px 16px}.grid{display:grid;grid-template-columns:320px 1fr;gap:20px}@media(max-width:800px){.grid{grid-template-columns:1fr}}.card{background:#161b22;border:1px solid #30363d;border-radius:8px;padding:16px}h2{font-size:14px;margin-bottom:12px;color:#58a6ff}.form-group{margin-bottom:12px}label{display:block;margin-bottom:3px;font-size:12px;color:#8b949e}select,input[type="number"]{width:100%;padding:8px;background:#0d1117;border:1px solid #30363d;border-radius:5px;color:#e6edf3;font-size:13px}select:focus,input:focus{outline:none;border-color:#58a6ff}.cbox{display:flex;flex-wrap:wrap;gap:6px;margin-top:4px}.cbox label{display:flex;align-items:center;gap:4px;font-size:11px;cursor:pointer;background:#21262d;padding:4px 8px;border-radius:3px}.cbox input{width:auto}.btn{background:#238636;color:#fff;border:none;padding:10px;border-radius:5px;cursor:pointer;font-size:13px;font-weight:600;width:100%;margin-top:6px}.btn:hover{background:#2ea44f}.btn:disabled{background:#30363d;cursor:not-allowed}.btn-dl{background:#1f6feb}.btn-dl:hover{background:#388bfd}.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:12px}.stat{background:#21262d;padding:10px;border-radius:5px;text-align:center}.stat-v{font-size:18px;font-weight:700;color:#58a6ff}.stat-l{font-size:10px;color:#8b949e}.tbl-wrap{overflow-x:auto;max-height:350px;border:1px solid #30363d;border-radius:5px}table{width:100%;border-collapse:collapse;font-size:11px}th,td{padding:6px 10px;text-align:left;border-bottom:1px solid #21262d}th{background:#21262d;position:sticky;top:0;font-weight:600;color:#58a6ff}tr:hover{background:#21262d}.prog{height:3px;background:#30363d;border-radius:2px;margin:10px 0;overflow:hidden;display:none}.prog-bar{height:100%;background:#238636;transition:width .3s}.status{font-size:11px;color:#8b949e;text-align:center;margin-top:6px}.info{font-size:11px;color:#8b949e;margin-top:8px}.footer{text-align:center;padding:16px;color:#8b949e;font-size:11px;border-top:1px solid #21262d;margin-top:24px}.footer a{color:#58a6ff;text-decoration:none}
</style>
</head>
<body>
<div class="hero"><div class="badge">v2.0</div><h1>Synthetic Health DB</h1><p>Generador de bases sinteticas para epidemiologia y bioestadistica</p></div>
<div class="container"><div class="grid">
<div class="card">
<h2>Configuracion</h2>
<div class="form-group"><label>Schema</label><select id="schema" onchange="updateUI()"><optgroup label="Datos Medicos"><option value="demographics">Demographics</option><option value="cie10">CIE-10</option><option value="encounters">Encounters</option></optgroup><optgroup label="Bioestadistica"><option value="survival">Survival</option><option value="casecontrol">Case-Control</option></optgroup><optgroup label="Epidemiologia"><option value="surveillance">Surveillance</option><option value="outbreak">Outbreak</option><option value="sir">SIR</option></optgroup></select></div>
<div class="form-group"><label>Filas: <span id="rowsD">10,000</span></label><input type="range" id="rows" min="100" max="500000" value="10000" step="100" oninput="updR()"></div>
<div class="form-group"><label>Seed</label><input type="number" id="seed" value="42" min="1" max="999999"></div>
<div class="form-group" id="errOpt" style="display:none"><label>Errores CIE-10</label><div class="cbox"><label><input type="checkbox" id="eS" checked>Espacios</label><label><input type="checkbox" id="eL" checked>Minusc</label><label><input type="checkbox" id="eT">Trunc</label><label><input type="checkbox" id="eI">Invalid</label></div></div>
<button class="btn" id="btnG" onclick="gen()">Generar</button>
<button class="btn btn-dl" id="btnD" onclick="dl()" disabled>Descargar CSV</button>
<div class="prog" id="prog"><div class="prog-bar" id="progB"></div></div>
<div class="status" id="st"></div>
</div>
<div class="card">
<h2>Preview</h2>
<div class="stats"><div class="stat"><div class="stat-v" id="sR">0</div><div class="stat-l">Filas</div></div><div class="stat"><div class="stat-v" id="sC">0</div><div class="stat-l">Cols</div></div><div class="stat"><div class="stat-v" id="sS">0 KB</div><div class="stat-l">Size</div></div></div>
<div class="tbl-wrap"><table><thead id="tH"></thead><tbody id="tB"></tbody></table></div>
<div class="info" id="inf"></div>
</div>
</div></div>
<div class="footer">Grupo CDSP | <a href="https://github.com/Rodotasso/synthetic-health-db">GitHub</a></div>
<script>
const RG=["01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16"],CI=["E11.0","E11.9","I10","I21.0","I25.1","J44.9","F32.9","M54.5","K21.0","N18.9","G20","C50.9","A00.0","J18.9","R10.4"];let D=null,C=[];
function m32(s){return function(){let t=s+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return((t^t>>>14)>>>0)/4294967296}}
function h(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0}return Math.abs(h).toString(16).toUpperCase().substring(0,6).padStart(6,"0")}
const G={
demographics:(n,s)=>{const r=m32(s),d=[];for(let i=0;i<n;i++){const y=1940+Math.floor(r()*80),x=r()<.51?"F":"M",g=RG[Math.floor(r()*RG.length)];d.push({patient_id:"SHDB-"+y+"-"+x+"-"+g+"-"+h(y+x+g+i),birth_year:y,age:2025-y,sex:x,region:g,urban:r()<.87?"urban":"rural",insurance:["fonasa_a","fonasa_b","fonasa_c","fonasa_d","isapre"][Math.floor(r()*5)]})}return d},
cie10:(n,s,e)=>{const r=m32(s),d=[];for(let i=0;i<n;i++){let c=CI[Math.floor(r()*CI.length)];if(e.s&&r()<.1)c=c.replace("."," .");if(e.l&&r()<.1)c=c.toLowerCase();if(e.t&&r()<.05)c=c.split(".")[0];if(e.i&&r()<.03)c="Z99.X";const y=1940+Math.floor(r()*80),x=r()<.51?"F":"M",g=RG[Math.floor(r()*RG.length)];d.push({patient_id:"SHDB-"+y+"-"+x+"-"+g+"-"+h(y+x+g+i),codigo:c,fecha:"2024-"+String(Math.floor(r()*12)+1).padStart(2,"0")+"-"+String(Math.floor(r()*28)+1).padStart(2,"0")})}return d},
encounters:(n,s)=>{const r=m32(s),d=[],T=["ambulatory","emergency","inpatient","telehealth"];for(let i=0;i<n;i++){const y=1940+Math.floor(r()*80),x=r()<.51?"F":"M",g=RG[Math.floor(r()*RG.length)];d.push({encounter_id:"ENC-"+String(i+1).padStart(8,"0"),patient_id:"SHDB-"+y+"-"+x+"-"+g+"-"+h(y+x+g+i),date:"2024-"+String(Math.floor(r()*12)+1).padStart(2,"0")+"-"+String(Math.floor(r()*28)+1).padStart(2,"0"),type:T[Math.floor(r()*T.length)],primary_dx:CI[Math.floor(r()*CI.length)]})}return d},
survival:(n,s)=>{const r=m32(s),d=[];for(let i=0;i<n;i++){const e=r()<.35?1:0;d.push({subject_id:"SUBJ-"+String(i+1).padStart(6,"0"),age:Math.floor(r()*50)+35,sex:r()<.52?"F":"M",treatment:r()<.5?"A":"B",stage:["I","II","III","IV"][Math.floor(r()*4)],followup_days:Math.floor(r()*1825)+30,event:e,censored:1-e})}return d},
casecontrol:(n,s)=>{const r=m32(s),d=[];for(let i=0;i<n;i++){const c=r()<.2;d.push({subject_id:"CC-"+String(i+1).padStart(5,"0"),case_status:c?1:0,matching_set:Math.floor(i/5)+1,age:Math.floor(r()*60)+25,sex:r()<.5?"M":"F",smoking:["never","former","current"][Math.floor(r()*3)],exposure:c?(r()<.6?1:0):(r()<.3?1:0)})}return d},
surveillance:(n,s)=>{const r=m32(s),d=[],ds=["A00","J09","A90","B05","A39"];for(let i=0;i<n;i++){const dy=i%365,g=RG[Math.floor(r()*RG.length)],di=ds[Math.floor(r()*ds.length)],b=di==="J09"?5:1,se=di==="J09"?1+.5*Math.sin(2*Math.PI*(dy-180)/365):1,o=r()<.02?r()*3+2:1,cs=Math.floor(r()*b*se*o*3),z=(cs-b)/Math.sqrt(b);let a="GREEN";if(z>=3)a="RED";else if(z>=2)a="ORANGE";else if(z>=1.5)a="YELLOW";d.push({date:"2024-"+String(Math.floor(dy/30)+1).padStart(2,"0")+"-"+String(dy%28+1).padStart(2,"0"),epi_week:Math.floor(dy/7)+1,region:g,disease:di,cases:cs,zscore:z.toFixed(2),alert:a})}return d},
outbreak:(n,s)=>{const r=m32(s),d=[];for(let i=0;i<n;i++){const dl=Math.floor(-Math.log(r())*7),gn=Math.floor(dl/5);d.push({case_id:"CASE-"+String(i+1).padStart(5,"0"),onset_day:dl,generation:gn,age:Math.floor(r()*80)+5,sex:r()<.5?"M":"F",secondary:gn>0?1:0,hospitalized:r()<.15?1:0,severity:["mild","moderate","severe"][Math.floor(r()*10)<7?0:(r()<.7?1:2)]})}return d},
sir:(n,s)=>{const d=[];let S=1e6,I=10,R=0;const b=.25,g=.1;for(let i=0;i<n;i++){const nI=b*S*I/1e6,nR=g*I;S-=nI;I+=nI-nR;R+=nR;d.push({day:i,susceptible:Math.round(S),infected:Math.round(I),recovered:Math.round(R),R_eff:(b*S/1e6/g).toFixed(2)})}return d}
};
function updateUI(){document.getElementById("errOpt").style.display=document.getElementById("schema").value==="cie10"?"block":"none"}
function updR(){document.getElementById("rowsD").textContent=parseInt(document.getElementById("rows").value).toLocaleString()}
function gen(){const sc=document.getElementById("schema").value,n=parseInt(document.getElementById("rows").value),sd=parseInt(document.getElementById("seed").value);document.getElementById("btnG").disabled=true;document.getElementById("btnD").disabled=true;document.getElementById("st").textContent="Generando...";document.getElementById("prog").style.display="block";document.getElementById("progB").style.width="0%";setTimeout(()=>{let e={};if(sc==="cie10")e={s:document.getElementById("eS").checked,l:document.getElementById("eL").checked,t:document.getElementById("eT").checked,i:document.getElementById("eI").checked};D=sc==="cie10"?G[sc](n,sd,e):G[sc](n,sd);C=Object.keys(D[0]||{});document.getElementById("progB").style.width="100%";const csv=toCSV(D);document.getElementById("sR").textContent=n.toLocaleString();document.getElementById("sC").textContent=C.length;document.getElementById("sS").textContent=(csv.length/1024).toFixed(0)+" KB";document.getElementById("tH").innerHTML="<tr>"+C.map(c=>"<th>"+c+"</th>").join("")+"</tr>";document.getElementById("tB").innerHTML=D.slice(0,12).map(r=>"<tr>"+C.map(c=>"<td>"+r[c]+"</td>").join("")+"</tr>").join("");document.getElementById("inf").textContent="12 de "+n.toLocaleString()+" filas";document.getElementById("st").textContent="OK: "+n.toLocaleString()+" filas";document.getElementById("btnG").disabled=false;document.getElementById("btnD").disabled=false},50)}
function toCSV(d){if(!d||!d.length)return"";const c=Object.keys(d[0]);return c.join(",")+"\n"+d.map(r=>c.map(k=>r[k]).join(",")).join("\n")}
function dl(){if(!D)return;const sc=document.getElementById("schema").value,csv=toCSV(D),b=new Blob([csv],{type:"text/csv"}),u=URL.createObjectURL(b),a=document.createElement("a");a.href=u;a.download=sc+"_"+D.length+".csv";document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(u);document.getElementById("st").textContent="Descargado"}
updateUI();updR();
</script>
</body>
</html>