html = r'''<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Synthetic Health DB</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:#0d1117;color:#e6edf3;min-height:100vh}.hero{background:linear-gradient(135deg,#1e3a8a,#3b82f6);padding:24px 20px;text-align:center}.hero h1{font-size:24px;margin-bottom:4px}.hero p{opacity:.9;font-size:12px}.badge{background:#f59f00;padding:2px 8px;border-radius:4px;font-size:10px;font-weight:600;margin-bottom:8px;display:inline-block}.container{max-width:1300px;margin:0 auto;padding:20px 16px}.grid{display:grid;grid-template-columns:300px 1fr 280px;gap:16px}@media(max-width:1000px){.grid{grid-template-columns:1fr}}.card{background:#161b22;border:1px solid #30363d;border-radius:8px;padding:14px}h2{font-size:13px;margin-bottom:10px;color:#58a6ff;display:flex;align-items:center;gap:6px}h3{font-size:11px;color:#8b949e;margin:10px 0 6px;text-transform:uppercase;letter-spacing:.5px}.form-group{margin-bottom:10px}label{display:block;margin-bottom:2px;font-size:11px;color:#8b949e}select,input[type="number"]{width:100%;padding:7px;background:#0d1117;border:1px solid #30363d;border-radius:4px;color:#e6edf3;font-size:12px}.cbox{display:flex;flex-wrap:wrap;gap:4px;margin-top:4px}.cbox label{display:flex;align-items:center;gap:3px;font-size:10px;cursor:pointer;background:#21262d;padding:3px 6px;border-radius:3px;transition:all .2s}.cbox label:hover{background:#30363d}.cbox label.active{background:#238636;color:#fff}.cbox input{width:auto;margin:0}.btn{background:#238636;color:#fff;border:none;padding:8px;border-radius:4px;cursor:pointer;font-size:12px;font-weight:600;width:100%;margin-top:5px}.btn:hover{background:#2ea44f}.btn:disabled{background:#30363d;cursor:not-allowed}.btn-dl{background:#1f6feb}.btn-dl:hover{background:#388bfd}.btn-sm{padding:5px 10px;width:auto;font-size:10px;margin:2px}.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:10px}.stat{background:#21262d;padding:8px;border-radius:4px;text-align:center}.stat-v{font-size:16px;font-weight:700;color:#58a6ff}.stat-l{font-size:9px;color:#8b949e}.tbl-wrap{overflow-x:auto;max-height:300px;border:1px solid #30363d;border-radius:4px}table{width:100%;border-collapse:collapse;font-size:10px}th,td{padding:5px 8px;text-align:left;border-bottom:1px solid #21262d}th{background:#21262d;position:sticky;top:0;font-weight:600;color:#58a6ff}tr:hover{background:#21262d}.prog{height:3px;background:#30363d;border-radius:2px;margin:8px 0;overflow:hidden;display:none}.prog-bar{height:100%;background:#238636;transition:width .3s}.status{font-size:10px;color:#8b949e;text-align:center;margin-top:5px}.info{font-size:10px;color:#8b949e;margin-top:6px}.footer{text-align:center;padding:12px;color:#8b949e;font-size:10px;border-top:1px solid #21262d;margin-top:20px}.footer a{color:#58a6ff;text-decoration:none}.tag{display:inline-block;padding:2px 6px;border-radius:3px;font-size:9px;margin:1px}.tag-green{background:#238636;color:#fff}.tag-blue{background:#1f6feb;color:#fff}.tag-purple{background:#8b5cf6;color:#fff}.tag-orange{background:#f59f00;color:#000}.analysis-item{background:#21262d;padding:8px;border-radius:4px;margin-bottom:6px;font-size:10px}.analysis-item strong{color:#58a6ff}.tabs{display:flex;gap:4px;margin-bottom:10px}.tab{padding:6px 12px;background:#21262d;border:none;color:#8b949e;cursor:pointer;border-radius:4px 4px 0 0;font-size:11px}.tab.active{background:#30363d;color:#58a6ff}.tab-content{display:none}.tab-content.active{display:block}.field-toggle{display:flex;align-items:center;justify-content:space-between;padding:4px 8px;background:#21262d;border-radius:3px;margin-bottom:4px;font-size:10px}.field-toggle input{margin-left:auto}
</style>
</head>
<body>
<div class="hero"><div class="badge">v3.0</div><h1>Synthetic Health DB</h1><p>Generador de bases sinteticas para epidemiologia y bioestadistica</p></div>
<div class="container"><div class="grid">
<div class="card">
<h2>Configuracion</h2>
<div class="tabs">
<button class="tab active" onclick="showTab('simple')">Simple</button>
<button class="tab" onclick="showTab('multi')">Multi-Schema</button>
<button class="tab" onclick="showTab('recipe')">Receta</button>
</div>
<div id="tab-simple" class="tab-content active">
<div class="form-group"><label>Schema</label><select id="schema" onchange="updateUI()"><optgroup label="Datos Medicos"><option value="demographics">Demographics</option><option value="cie10">CIE-10</option><option value="encounters">Encounters</option><option value="labs">Laboratorios</option></optgroup><optgroup label="Bioestadistica"><option value="survival">Survival Cohort</option><option value="casecontrol">Case-Control</option><option value="rct">Ensayo Clinico (RCT)</option></optgroup><optgroup label="Epidemiologia"><option value="surveillance">Surveillance</option><option value="outbreak">Outbreak</option><option value="sir">SIR Model</option></optgroup></select></div>
</div>
<div id="tab-multi" class="tab-content">
<label>Seleccionar schemas (linkados por patient_id)</label>
<div class="cbox" id="multiSchemas">
<label><input type="checkbox" value="demographics" checked>Demographics</label>
<label><input type="checkbox" value="cie10">CIE-10</label>
<label><input type="checkbox" value="encounters">Encounters</label>
<label><input type="checkbox" value="labs">Labs</label>
<label><input type="checkbox" value="survival">Survival</label>
</div>
</div>
<div id="tab-recipe" class="tab-content">
<label>Campos a incluir</label>
<div id="recipeFields"></div>
</div>
<div class="form-group"><label>Filas: <span id="rowsD">10,000</span></label><input type="range" id="rows" min="100" max="500000" value="10000" step="100" oninput="updR()"></div>
<div class="form-group"><label>Seed</label><input type="number" id="seed" value="42" min="1" max="999999"></div>
<div class="form-group" id="errOpt" style="display:none"><label>Errores CIE-10</label><div class="cbox"><label><input type="checkbox" id="eS" checked>Espacios</label><label><input type="checkbox" id="eL" checked>Minusc</label><label><input type="checkbox" id="eT">Trunc</label><label><input type="checkbox" id="eI">Invalid</label></div></div>
<button class="btn" id="btnG" onclick="gen()">Generar</button>
<button class="btn btn-dl" id="btnD" onclick="dl()" disabled>Descargar CSV</button>
<button class="btn btn-dl" id="btnZ" onclick="dlZip()" disabled style="display:none">Descargar ZIP (Multi)</button>
<div class="prog" id="prog"><div class="prog-bar" id="progB"></div></div>
<div class="status" id="st"></div>
</div>
<div class="card">
<h2>Preview</h2>
<div class="stats"><div class="stat"><div class="stat-v" id="sR">0</div><div class="stat-l">Filas</div></div><div class="stat"><div class="stat-v" id="sC">0</div><div class="stat-l">Cols</div></div><div class="stat"><div class="stat-v" id="sS">0 KB</div><div class="stat-l">Size</div></div></div>
<div class="tbl-wrap"><table><thead id="tH"></thead><tbody id="tB"></tbody></table></div>
<div class="info" id="inf"></div>
</div>
<div class="card">
<h2>Guia de Analisis</h2>
<div id="analysisGuide">
<div class="analysis-item"><strong>Demographics</strong><br><span class="tag tag-blue">Descriptivo</span><span class="tag tag-green">Chi-cuadrado</span><span class="tag tag-purple">Piramide poblacional</span></div>
</div>
<h3>Analisis Posibles</h3>
<div id="possibleAnalysis"></div>
<h3>Variables</h3>
<div id="varTypes"></div>
</div>
</div></div>
<div class="footer">Grupo CDSP | <a href="https://github.com/Rodotasso/synthetic-health-db">GitHub</a></div>
<script>
const RG=["01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16"],CI=["E11.0","E11.9","I10","I21.0","I25.1","J44.9","F32.9","M54.5","K21.0","N18.9","G20","C50.9","A00.0","J18.9","R10.4"];
let D=null,C=[],MD={},mode="simple";
const META={
demographics:{name:"Demographics",vars:{patient_id:"ID",age:"Continua",sex:"Categorica",region:"Categorica",urban:"Categorica",insurance:"Categorica"},analysis:["Descriptivo","Chi-cuadrado","Piramide poblacional","Regresion logistica"],fields:["patient_id","birth_year","age","sex","region","urban","insurance"]},
cie10:{name:"CIE-10",vars:{patient_id:"ID",codigo:"Categorica",fecha:"Fecha"},analysis:["Frecuencias","Validacion codigos","Series temporales"],fields:["patient_id","codigo","fecha"]},
encounters:{name:"Encounters",vars:{encounter_id:"ID",patient_id:"ID",date:"Fecha",type:"Categorica",primary_dx:"Categorica"},analysis:["Utilizacion servicios","Tasas consulta","Estacionalidad"],fields:["encounter_id","patient_id","date","type","primary_dx"]},
labs:{name:"Laboratorios",vars:{patient_id:"ID",test_name:"Categorica",value:"Continua",unit:"Categorica",abnormal:"Categorica"},analysis:["Rangos referencia","Tendencias","Correlaciones"],fields:["patient_id","test_date","test_name","value","unit","abnormal_flag"]},
survival:{name:"Survival Cohort",vars:{subject_id:"ID",age:"Continua",sex:"Categorica",treatment:"Categorica",stage:"Ordinal",followup_days:"Tiempo",event:"Binaria",censored:"Binaria"},analysis:["Kaplan-Meier","Cox regression","Log-rank test","Hazard ratios"],fields:["subject_id","age","sex","treatment","stage","followup_days","event","censored"]},
casecontrol:{name:"Case-Control",vars:{subject_id:"ID",case_status:"Binaria",age:"Continua",sex:"Categorica",exposure:"Binaria"},analysis:["Odds Ratio","Regresion logistica condicional","Matching analysis","Chi-cuadrado"],fields:["subject_id","case_status","matching_set","age","sex","smoking","exposure"]},
rct:{name:"Ensayo Clinico",vars:{subject_id:"ID",arm:"Categorica",baseline:"Continua",outcome:"Continua",adverse_event:"Binaria"},analysis:["ITT analysis","Per-protocol","ANCOVA","NNT/NNH"],fields:["subject_id","randomization_date","arm","baseline_value","week4_value","week8_value","adverse_event","dropout"]},
surveillance:{name:"Surveillance",vars:{date:"Fecha",region:"Categorica",disease:"Categorica",cases:"Conteo",alert:"Ordinal"},analysis:["Deteccion brotes","CUSUM","Series temporales","Mapas calor"],fields:["date","epi_week","region","disease","cases","zscore","alert"]},
outbreak:{name:"Outbreak",vars:{case_id:"ID",onset_day:"Tiempo",generation:"Ordinal",severity:"Ordinal"},analysis:["Curva epidemica","R efectivo","Cadena transmision"],fields:["case_id","onset_day","generation","age","sex","secondary","hospitalized","severity"]},
sir:{name:"SIR Model",vars:{day:"Tiempo",susceptible:"Conteo",infected:"Conteo",recovered:"Conteo",R_eff:"Continua"},analysis:["Dinamica epidemia","R0 estimation","Proyecciones"],fields:["day","susceptible","infected","recovered","R_eff"]}
};
function m32(s){return function(){let t=s+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return((t^t>>>14)>>>0)/4294967296}}
function h(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0}return Math.abs(h).toString(16).toUpperCase().substring(0,6).padStart(6,"0")}
const G={
demographics:(n,s,f)=>{const r=m32(s),d=[];for(let i=0;i<n;i++){const y=1940+Math.floor(r()*80),x=r()<.51?"F":"M",g=RG[Math.floor(r()*RG.length)],row={};if(!f||f.includes("patient_id"))row.patient_id="SHDB-"+y+"-"+x+"-"+g+"-"+h(y+x+g+i);if(!f||f.includes("birth_year"))row.birth_year=y;if(!f||f.includes("age"))row.age=2025-y;if(!f||f.includes("sex"))row.sex=x;if(!f||f.includes("region"))row.region=g;if(!f||f.includes("urban"))row.urban=r()<.87?"urban":"rural";if(!f||f.includes("insurance"))row.insurance=["fonasa_a","fonasa_b","fonasa_c","fonasa_d","isapre"][Math.floor(r()*5)];d.push(row)}return d},
cie10:(n,s,e,f)=>{const r=m32(s),d=[];for(let i=0;i<n;i++){let c=CI[Math.floor(r()*CI.length)];if(e&&e.s&&r()<.1)c=c.replace("."," .");if(e&&e.l&&r()<.1)c=c.toLowerCase();if(e&&e.t&&r()<.05)c=c.split(".")[0];if(e&&e.i&&r()<.03)c="Z99.X";const y=1940+Math.floor(r()*80),x=r()<.51?"F":"M",g=RG[Math.floor(r()*RG.length)],row={};if(!f||f.includes("patient_id"))row.patient_id="SHDB-"+y+"-"+x+"-"+g+"-"+h(y+x+g+i);if(!f||f.includes("codigo"))row.codigo=c;if(!f||f.includes("fecha"))row.fecha="2024-"+String(Math.floor(r()*12)+1).padStart(2,"0")+"-"+String(Math.floor(r()*28)+1).padStart(2,"0");d.push(row)}return d},
encounters:(n,s,_,f)=>{const r=m32(s),d=[],T=["ambulatory","emergency","inpatient","telehealth"];for(let i=0;i<n;i++){const y=1940+Math.floor(r()*80),x=r()<.51?"F":"M",g=RG[Math.floor(r()*RG.length)],row={};if(!f||f.includes("encounter_id"))row.encounter_id="ENC-"+String(i+1).padStart(8,"0");if(!f||f.includes("patient_id"))row.patient_id="SHDB-"+y+"-"+x+"-"+g+"-"+h(y+x+g+i);if(!f||f.includes("date"))row.date="2024-"+String(Math.floor(r()*12)+1).padStart(2,"0")+"-"+String(Math.floor(r()*28)+1).padStart(2,"0");if(!f||f.includes("type"))row.type=T[Math.floor(r()*T.length)];if(!f||f.includes("primary_dx"))row.primary_dx=CI[Math.floor(r()*CI.length)];d.push(row)}return d},
labs:(n,s,_,f)=>{const r=m32(s),d=[],tests=[["glucose",70,100,"mg/dL"],["creatinine",0.7,1.3,"mg/dL"],["hemoglobin",12,17,"g/dL"],["wbc",4.5,11,"K/uL"],["cholesterol",0,200,"mg/dL"]];for(let i=0;i<n;i++){const y=1940+Math.floor(r()*80),x=r()<.51?"F":"M",g=RG[Math.floor(r()*RG.length)],t=tests[Math.floor(r()*tests.length)],v=r()<.8?t[1]+(r()*(t[2]-t[1])):t[1]*(.5+r()),row={};if(!f||f.includes("patient_id"))row.patient_id="SHDB-"+y+"-"+x+"-"+g+"-"+h(y+x+g+i);if(!f||f.includes("test_date"))row.test_date="2024-"+String(Math.floor(r()*12)+1).padStart(2,"0")+"-"+String(Math.floor(r()*28)+1).padStart(2,"0");if(!f||f.includes("test_name"))row.test_name=t[0];if(!f||f.includes("value"))row.value=v.toFixed(1);if(!f||f.includes("unit"))row.unit=t[3];if(!f||f.includes("abnormal_flag"))row.abnormal_flag=v<t[1]?"L":(v>t[2]?"H":"N");d.push(row)}return d},
survival:(n,s,_,f)=>{const r=m32(s),d=[];for(let i=0;i<n;i++){const e=r()<.35?1:0,row={};if(!f||f.includes("subject_id"))row.subject_id="SUBJ-"+String(i+1).padStart(6,"0");if(!f||f.includes("age"))row.age=Math.floor(r()*50)+35;if(!f||f.includes("sex"))row.sex=r()<.52?"F":"M";if(!f||f.includes("treatment"))row.treatment=r()<.5?"A":"B";if(!f||f.includes("stage"))row.stage=["I","II","III","IV"][Math.floor(r()*4)];if(!f||f.includes("followup_days"))row.followup_days=Math.floor(r()*1825)+30;if(!f||f.includes("event"))row.event=e;if(!f||f.includes("censored"))row.censored=1-e;d.push(row)}return d},
casecontrol:(n,s,_,f)=>{const r=m32(s),d=[];for(let i=0;i<n;i++){const c=r()<.2,row={};if(!f||f.includes("subject_id"))row.subject_id="CC-"+String(i+1).padStart(5,"0");if(!f||f.includes("case_status"))row.case_status=c?1:0;if(!f||f.includes("matching_set"))row.matching_set=Math.floor(i/5)+1;if(!f||f.includes("age"))row.age=Math.floor(r()*60)+25;if(!f||f.includes("sex"))row.sex=r()<.5?"M":"F";if(!f||f.includes("smoking"))row.smoking=["never","former","current"][Math.floor(r()*3)];if(!f||f.includes("exposure"))row.exposure=c?(r()<.6?1:0):(r()<.3?1:0);d.push(row)}return d},
rct:(n,s,_,f)=>{const r=m32(s),d=[];for(let i=0;i<n;i++){const arm=r()<.5?"treatment":"placebo",bl=50+r()*30,row={};if(!f||f.includes("subject_id"))row.subject_id="RCT-"+String(i+1).padStart(5,"0");if(!f||f.includes("randomization_date"))row.randomization_date="2024-"+String(Math.floor(r()*12)+1).padStart(2,"0")+"-"+String(Math.floor(r()*28)+1).padStart(2,"0");if(!f||f.includes("arm"))row.arm=arm;if(!f||f.includes("baseline_value"))row.baseline_value=bl.toFixed(1);if(!f||f.includes("week4_value"))row.week4_value=(bl+(arm==="treatment"?-10:-2)+r()*10).toFixed(1);if(!f||f.includes("week8_value"))row.week8_value=(bl+(arm==="treatment"?-15:-3)+r()*12).toFixed(1);if(!f||f.includes("adverse_event"))row.adverse_event=r()<(arm==="treatment"?.15:.08)?1:0;if(!f||f.includes("dropout"))row.dropout=r()<.1?1:0;d.push(row)}return d},
surveillance:(n,s,_,f)=>{const r=m32(s),d=[],ds=["A00","J09","A90","B05","A39"];for(let i=0;i<n;i++){const dy=i%365,g=RG[Math.floor(r()*RG.length)],di=ds[Math.floor(r()*ds.length)],b=di==="J09"?5:1,se=di==="J09"?1+.5*Math.sin(2*Math.PI*(dy-180)/365):1,o=r()<.02?r()*3+2:1,cs=Math.floor(r()*b*se*o*3),z=(cs-b)/Math.sqrt(b);let a="GREEN";if(z>=3)a="RED";else if(z>=2)a="ORANGE";else if(z>=1.5)a="YELLOW";const row={};if(!f||f.includes("date"))row.date="2024-"+String(Math.floor(dy/30)+1).padStart(2,"0")+"-"+String(dy%28+1).padStart(2,"0");if(!f||f.includes("epi_week"))row.epi_week=Math.floor(dy/7)+1;if(!f||f.includes("region"))row.region=g;if(!f||f.includes("disease"))row.disease=di;if(!f||f.includes("cases"))row.cases=cs;if(!f||f.includes("zscore"))row.zscore=z.toFixed(2);if(!f||f.includes("alert"))row.alert=a;d.push(row)}return d},
outbreak:(n,s,_,f)=>{const r=m32(s),d=[];for(let i=0;i<n;i++){const dl=Math.floor(-Math.log(r())*7),gn=Math.floor(dl/5),row={};if(!f||f.includes("case_id"))row.case_id="CASE-"+String(i+1).padStart(5,"0");if(!f||f.includes("onset_day"))row.onset_day=dl;if(!f||f.includes("generation"))row.generation=gn;if(!f||f.includes("age"))row.age=Math.floor(r()*80)+5;if(!f||f.includes("sex"))row.sex=r()<.5?"M":"F";if(!f||f.includes("secondary"))row.secondary=gn>0?1:0;if(!f||f.includes("hospitalized"))row.hospitalized=r()<.15?1:0;if(!f||f.includes("severity"))row.severity=["mild","moderate","severe"][Math.floor(r()*10)<7?0:(r()<.7?1:2)];d.push(row)}return d},
sir:(n,s)=>{const d=[];let S=1e6,I=10,R=0;const b=.25,g=.1;for(let i=0;i<n;i++){const nI=b*S*I/1e6,nR=g*I;S-=nI;I+=nI-nR;R+=nR;d.push({day:i,susceptible:Math.round(S),infected:Math.round(I),recovered:Math.round(R),R_eff:(b*S/1e6/g).toFixed(2)})}return d}
};
function showTab(t){mode=t;document.querySelectorAll(".tab").forEach(e=>e.classList.remove("active"));document.querySelectorAll(".tab-content").forEach(e=>e.classList.remove("active"));document.querySelector(".tab-content#tab-"+t).classList.add("active");document.querySelector(".tab[onclick*='"+t+"']").classList.add("active");document.getElementById("btnZ").style.display=t==="multi"?"block":"none";document.getElementById("btnD").style.display=t==="multi"?"none":"block";if(t==="recipe")updateRecipe()}
function updateRecipe(){const sc=document.getElementById("schema").value,m=META[sc];if(!m)return;let html="";m.fields.forEach(f=>{html+='<div class="field-toggle"><span>'+f+'</span><input type="checkbox" checked data-field="'+f+'"></div>'});document.getElementById("recipeFields").innerHTML=html}
function updateUI(){const sc=document.getElementById("schema").value;document.getElementById("errOpt").style.display=sc==="cie10"?"block":"none";updateAnalysisGuide(sc);if(mode==="recipe")updateRecipe()}
function updateAnalysisGuide(sc){const m=META[sc];if(!m)return;let html='<div class="analysis-item"><strong>'+m.name+'</strong><br>';m.analysis.forEach(a=>{const cls=a.includes("regresion")||a.includes("Cox")?"tag-purple":a.includes("Chi")||a.includes("Odds")?"tag-green":"tag-blue";html+='<span class="tag '+cls+'">'+a+'</span>'});html+='</div>';document.getElementById("analysisGuide").innerHTML=html;let pa="";m.analysis.forEach(a=>{pa+='<div style="font-size:10px;padding:3px 0">- '+a+'</div>'});document.getElementById("possibleAnalysis").innerHTML=pa;let vt="";Object.entries(m.vars).forEach(([k,v])=>{const cls=v==="Continua"?"tag-blue":v==="Categorica"?"tag-green":v==="Binaria"?"tag-purple":"tag-orange";vt+='<span class="tag '+cls+'" style="margin:1px">'+k+': '+v+'</span>'});document.getElementById("varTypes").innerHTML=vt}
function updR(){document.getElementById("rowsD").textContent=parseInt(document.getElementById("rows").value).toLocaleString()}
function getSelectedFields(){if(mode!=="recipe")return null;const checks=document.querySelectorAll("#recipeFields input:checked");return Array.from(checks).map(c=>c.dataset.field)}
function gen(){const n=parseInt(document.getElementById("rows").value),sd=parseInt(document.getElementById("seed").value);document.getElementById("btnG").disabled=true;document.getElementById("btnD").disabled=true;document.getElementById("btnZ").disabled=true;document.getElementById("st").textContent="Generando...";document.getElementById("prog").style.display="block";document.getElementById("progB").style.width="0%";
setTimeout(()=>{if(mode==="multi"){MD={};const checks=document.querySelectorAll("#multiSchemas input:checked");checks.forEach(c=>{const sc=c.value;let e=null;if(sc==="cie10")e={s:document.getElementById("eS").checked,l:document.getElementById("eL").checked,t:document.getElementById("eT").checked,i:document.getElementById("eI").checked};MD[sc]=G[sc](n,sd,e,null)});const first=Object.keys(MD)[0];D=MD[first]||[];C=Object.keys(D[0]||{})}else{const sc=document.getElementById("schema").value,fields=getSelectedFields();let e=null;if(sc==="cie10")e={s:document.getElementById("eS").checked,l:document.getElementById("eL").checked,t:document.getElementById("eT").checked,i:document.getElementById("eI").checked};D=G[sc](n,sd,e,fields);C=Object.keys(D[0]||{})}
document.getElementById("progB").style.width="100%";const csv=toCSV(D);document.getElementById("sR").textContent=(mode==="multi"?Object.keys(MD).length+"x":"")+n.toLocaleString();document.getElementById("sC").textContent=C.length;document.getElementById("sS").textContent=(csv.length/1024).toFixed(0)+" KB";document.getElementById("tH").innerHTML="<tr>"+C.map(c=>"<th>"+c+"</th>").join("")+"</tr>";document.getElementById("tB").innerHTML=D.slice(0,10).map(r=>"<tr>"+C.map(c=>"<td>"+(r[c]!==undefined?r[c]:"")+"</td>").join("")+"</tr>").join("");document.getElementById("inf").textContent="10 de "+n.toLocaleString()+" filas"+(mode==="multi"?" ("+Object.keys(MD).length+" schemas)":"");document.getElementById("st").textContent="OK";document.getElementById("btnG").disabled=false;document.getElementById("btnD").disabled=false;document.getElementById("btnZ").disabled=false},50)}
function toCSV(d){if(!d||!d.length)return"";const c=Object.keys(d[0]);return c.join(",")+"\n"+d.map(r=>c.map(k=>r[k]!==undefined?r[k]:"").join(",")).join("\n")}
function dl(){if(!D)return;const sc=document.getElementById("schema").value,csv=toCSV(D),b=new Blob([csv],{type:"text/csv"}),u=URL.createObjectURL(b),a=document.createElement("a");a.href=u;a.download=sc+"_"+D.length+".csv";document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(u);document.getElementById("st").textContent="Descargado"}
function dlZip(){if(!MD||!Object.keys(MD).length)return;let allCsv="";Object.entries(MD).forEach(([name,data])=>{allCsv+="### "+name.toUpperCase()+" ###\n"+toCSV(data)+"\n\n"});const b=new Blob([allCsv],{type:"text/plain"}),u=URL.createObjectURL(b),a=document.createElement("a");a.href=u;a.download="multi_schema_"+Object.keys(MD).length+"_tables.txt";document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(u);document.getElementById("st").textContent="Multi-schema descargado"}
updateUI();updR();
</script>
</body>
</html>'''
with open('index.html', 'w', encoding='utf-8') as f:
    f.write(html)
print('OK')
